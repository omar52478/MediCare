{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div class="container">
    <!-- Profile Header -->
    <div class="glass-card fade-in mb-3">
        <div class="profile-header">
            <div class="profile-avatar">
                {% if profile.image %}
                <img src="{{ profile.image.url }}" alt="{{ profile.user.username }}">
                {% else %}
                <div class="default-avatar">
                    <i class="fas fa-user"></i>
                </div>
                {% endif %}
                <div class="status-badge"></div>
            </div>
            <div class="profile-info">
                <h2>{{ profile.user.username }}</h2>
                <p style="margin-bottom: var(--space-sm);">
                    <i class="fas fa-envelope" style="color: var(--primary-400);"></i>
                    {{ profile.user.email }}
                </p>
                {% if user.is_superuser %}
                <span class="role" style="background: linear-gradient(135deg, #ff6b6b, #ffa726);">
                    <i class="fas fa-crown"></i> Admin
                </span>
                {% elif user.is_staff %}
                <span class="role">
                    <i class="fas fa-user-md"></i> Doctor
                </span>
                {% else %}
                <span class="role" style="background: var(--gradient-success);">
                    <i class="fas fa-user"></i> Patient
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Profile Details Grid -->
    <div class="d-grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--space-xl);">

        <!-- Personal Information -->
        <div class="glass-card fade-in" style="animation-delay: 0.1s;">
            <h3 style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-lg);">
                <i class="fas fa-id-card" style="color: var(--primary-400);"></i>
                Personal Information
            </h3>
            <div class="info-list">
                <div class="info-item"
                    style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md) 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div
                        style="width: 40px; height: 40px; background: rgba(33,150,243,0.2); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-phone" style="color: var(--primary-400);"></i>
                    </div>
                    <div>
                        <small style="color: var(--gray-500);">Phone</small>
                        <p style="margin: 0; color: #fff;">{{ profile.phone }}</p>
                    </div>
                </div>

                <div class="info-item"
                    style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md) 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div
                        style="width: 40px; height: 40px; background: rgba(76,175,80,0.2); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-birthday-cake" style="color: var(--success-500);"></i>
                    </div>
                    <div>
                        <small style="color: var(--gray-500);">Age</small>
                        <p style="margin: 0; color: #fff;">{{ profile.age }} years old</p>
                    </div>
                </div>

                <div class="info-item"
                    style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md) 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div
                        style="width: 40px; height: 40px; background: rgba(156,39,176,0.2); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-id-badge" style="color: #ba68c8;"></i>
                    </div>
                    <div>
                        <small style="color: var(--gray-500);">National ID</small>
                        <p style="margin: 0; color: #fff;">{{ profile.national_id }}</p>
                    </div>
                </div>

                <div class="info-item"
                    style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md) 0;">
                    <div
                        style="width: 40px; height: 40px; background: rgba(255,152,0,0.2); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-map-marker-alt" style="color: var(--warning-500);"></i>
                    </div>
                    <div>
                        <small style="color: var(--gray-500);">Address</small>
                        <p style="margin: 0; color: #fff;">{{ profile.street }}, {{ profile.city }}, {{
                            profile.governorate }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contact -->
        <div class="glass-card fade-in" style="animation-delay: 0.2s;">
            <h3 style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-lg);">
                <i class="fas fa-first-aid" style="color: var(--error-500);"></i>
                Emergency Contact
            </h3>
            <div class="info-list">
                <div class="info-item"
                    style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md) 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div
                        style="width: 40px; height: 40px; background: rgba(244,67,54,0.2); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user-friends" style="color: var(--error-500);"></i>
                    </div>
                    <div>
                        <small style="color: var(--gray-500);">Contact Name</small>
                        <p style="margin: 0; color: #fff;">{{ profile.emergency_name }}</p>
                    </div>
                </div>

                <div class="info-item"
                    style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md) 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div
                        style="width: 40px; height: 40px; background: rgba(0,188,212,0.2); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-phone-alt" style="color: var(--accent-400);"></i>
                    </div>
                    <div>
                        <small style="color: var(--gray-500);">Phone</small>
                        <p style="margin: 0; color: #fff;">{{ profile.emergency_phone }}</p>
                    </div>
                </div>

                <div class="info-item"
                    style="display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md) 0;">
                    <div
                        style="width: 40px; height: 40px; background: rgba(233,30,99,0.2); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-heart" style="color: #ec407a;"></i>
                    </div>
                    <div>
                        <small style="color: var(--gray-500);">Relationship</small>
                        <p style="margin: 0; color: #fff;">{{ profile.emergency_relation }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Doctor Options -->
    {% if user.is_staff %}
    <div class="glass-card fade-in mt-3" style="animation-delay: 0.3s;">
        <h3 style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-lg);">
            <i class="fas fa-stethoscope" style="color: var(--primary-400);"></i>
            Doctor Dashboard
        </h3>
        <div class="d-flex gap-2 flex-wrap">
            <a href="{% url 'my_availability_add' %}" class="btn btn-success">
                <i class="fas fa-plus-circle"></i>
                Add Availability
            </a>
            <a href="{% url 'my_availability_list' %}" class="btn btn-primary">
                <i class="fas fa-calendar-alt"></i>
                View My Schedule
            </a>
            {% if user.is_superuser %}
            <a href="{% url 'admin:index' %}" class="btn btn-secondary">
                <i class="fas fa-cogs"></i>
                Admin Dashboard
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Appointments Section -->
    {% if doctor_appointments %}
    <div class="glass-card fade-in mt-3" style="animation-delay: 0.4s;">
        <h3 style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-lg);">
            <i class="fas fa-calendar-check" style="color: var(--success-500);"></i>
            Appointments (as Doctor)
            <span
                style="background: var(--gradient-success); padding: 2px 10px; border-radius: var(--radius-full); font-size: 0.8rem; margin-left: auto;">
                {{ doctor_appointments|length }} Total
            </span>
        </h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th><i class="fas fa-user"></i> Patient</th>
                        <th><i class="fas fa-calendar"></i> Day</th>
                        <th><i class="fas fa-clock"></i> Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in doctor_appointments %}
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: var(--space-sm);">
                                <div
                                    style="width: 35px; height: 35px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user" style="font-size: 0.8rem;"></i>
                                </div>
                                {{ a.patient.username }}
                            </div>
                        </td>
                        <td>{{ a.day }}</td>
                        <td>{{ a.time|time:"h:i A" }}</td>
                        <td>
                            <span
                                style="background: rgba(76,175,80,0.2); color: #81c784; padding: 4px 12px; border-radius: var(--radius-full); font-size: 0.8rem;">
                                <i class="fas fa-check-circle"></i> Confirmed
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% if patient_appointments %}
    <div class="glass-card fade-in mt-3" style="animation-delay: 0.5s;">
        <h3 style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-lg);">
            <i class="fas fa-notes-medical" style="color: var(--primary-400);"></i>
            My Appointments
            <span
                style="background: var(--gradient-medical); padding: 2px 10px; border-radius: var(--radius-full); font-size: 0.8rem; margin-left: auto;">
                {{ patient_appointments|length }} Total
            </span>
        </h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th><i class="fas fa-user-md"></i> Doctor</th>
                        <th><i class="fas fa-calendar"></i> Day</th>
                        <th><i class="fas fa-clock"></i> Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in patient_appointments %}
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: var(--space-sm);">
                                <div
                                    style="width: 35px; height: 35px; background: var(--gradient-medical); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user-md" style="font-size: 0.8rem;"></i>
                                </div>
                                Dr. {{ a.doctor.user.username }}
                            </div>
                        </td>
                        <td>{{ a.day }}</td>
                        <td>{{ a.time|time:"h:i A" }}</td>
                        <td>
                            <span
                                style="background: rgba(33,150,243,0.2); color: var(--primary-300); padding: 4px 12px; border-radius: var(--radius-full); font-size: 0.8rem;">
                                <i class="fas fa-calendar-check"></i> Scheduled
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% if not patient_appointments and not doctor_appointments %}
    <div class="glass-card fade-in mt-3 text-center" style="animation-delay: 0.4s; padding: var(--space-3xl);">
        <i class="fas fa-calendar-times"
            style="font-size: 4rem; color: var(--gray-500); margin-bottom: var(--space-lg);"></i>
        <h3>No Appointments Yet</h3>
        <p style="margin-bottom: var(--space-lg);">You haven't booked any appointments. Start by finding a doctor!</p>
        <a href="{% url 'book_appointment' %}" class="btn btn-primary btn-lg">
            <i class="fas fa-calendar-plus"></i>
            Book Your First Appointment
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}